<html>
    <head>
        <title>Traquito</title>


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-07H1M3KB40"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-07H1M3KB40');
</script>

<!-- https://github.com/apvarun/toastify-js/blob/master/README.md -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">



<script>
</script>

        <script type='module'>
import * as autl from './AppUtl.js';
import { ConfigController } from './ConfigController.js';
import { ConnectController } from './ConnectController.js';
import { Connection } from './Connection.js';
import { DebugController } from './DebugController.js';
import { DeviceInfoController } from './DeviceInfoController.js';
import { Event } from './Event.js';




/////////////////////////////////////////////////////////////////////
// App
/////////////////////////////////////////////////////////////////////

export class App
{
    constructor()
    {
        console.log("App Started");

        Event.AddHandler(this);

        // create
        this.conn = new Connection();
        
        this.connectController = new ConnectController();
        this.configController  = new ConfigController();
        this.debugController = new DebugController();
        this.deviceInfoController  = new DeviceInfoController();


        // configure
        this.conn.Configure({
            dbg: this.debugController,
            eventer: this.eventer,
            filterList: [
                {
                    usbVendorId: 12259,
                    usbProductId: 8,
                },
            ],
        });

        this.connectController.Configure({
            dbg: this.debugController,
            conn: this.conn,
            idStatus: "status",
            idConnect: "connect",
            idDisconnect: "disconnect",
        });
        
        this.configController.Configure({
            dbg: this.debugController,
            conn: this.conn,
            idBand: "band",
            idChannel: "channel",
            idCallsign: "callsign",
            idSaveButton: "saveConfig",
            idRestoreButton: "restoreConfig",
            idDefaultButton: "defaultConfig",
            idFreq: "freq",
            idCorrectionRange: "correctionRange",
            idCorrectionNumber: "correctionNumber",
        });

        this.debugController.Configure({
            dbg: this.debugController,
            conn: this.conn,
            idForm: "form",
            idInput: "input",
            idOutput: "output",
            idPing: "ping",
            idPing2: "ping2",
            idClear: "clear",
        });

        this.deviceInfoController.Configure({
            dbg: this.debugController,
            conn: this.conn,
            idDeviceInfo: "deviceInfo",
        });

    }

// private

    OnEvent(evt)
    {
        switch (evt.type) {
            case "connected": this.OnConnected(); break;
            case "disconnected": this.OnDisconnected(evt.ok); break;
        }
    }

    OnConnected()
    {
        autl.ToastOk("Connected");
    }
    
    OnDisconnected(ok)
    {
        if (ok)
        {
            autl.ToastOk("Disconnected (expected)");
        }
        else
        {
            autl.ToastErr("Disconnected (unexpected)");
        }
    }
}

export let app = null;

window.addEventListener('DOMContentLoaded', (event) => {
    app = new App();
    window.app = app;
});

</script>


<link rel="stylesheet" type="text/css" href="/traquito.css">

<style>


#status {
    padding: 2px;
    display: inline-block;
    min-width: 150px;
}

#deviceInfo {
    display: inline-block;
}

#correctionRange {
    direction: rtl;
}

textarea {
    width: 100%;
}

input[type='range'] {
    width: 50%;
}


</style>
    </head>

    <body>

        <fieldset class="outer">
            <legend>Tracker Connection</legend>
            <section>
                <button id="connect">Connect</button>
                <button id="disconnect">Disconnect</button>
                Status <span id="status">Disconnected</span>
                <span id="deviceInfo"></span>
            </section>
        </fieldset>

        <br/>
        <br/>

        <fieldset class="outer">
            <legend>Configuration</legend>

            <button id="saveConfig">Save</button>
            <button id="restoreConfig">Show Saved</button>
            <button id="defaultConfig">Show Default</button>
            <br/>
            <br/>

            <fieldset class="inner">
                <legend>WSPR Configuration</legend>
        
                <div>
                <label>Band</label>
                    <select id="band" title="band" value="20m">
                        <option value="2190m">2190m (LF)</option>
                        <option value="630m">630m (MF)</option>
                        <option value="160m">160m</option>
                        <option value="80m">80m</option>
                        <option value="60m">60m</option>
                        <option value="40m">40m</option>
                        <option value="30m">30m</option>
                        <option value="20m" selected>20m</option>
                        <option value="17m">17m</option>
                        <option value="15m">15m</option>
                        <option value="12m">12m</option>
                        <option value="10m">10m</option>
                        <option value="6m">6m</option>
                        <option value="4m">4m</option>
                        <option value="2m">2m</option>
                        <option value="70cm">70cm</option>
                        <option value="23cm">23cm</option>
                    </select>
                </div>

                <div>
                    <label>Channel</label> <input id="channel" type="number" value="0" min="0" max="599" title="channel" placeholder="channel">
                </div>

                <div>
                    <label>Callsign</label> <input id="callsign" title="callsign" placeholder="callsign" size="7"></input>
                </div>

                <br/>

                <div>
                    <label>Lane Freq</label> <span id="freq">14,097,020</span>
                </div>
            </fieldset>

            <br/>

            <fieldset class="inner">
                <legend>SI5351 Correction Configuration</legend>
                <div>
                    <label>
                        Correction
                    </label>
                    <input id="correctionRange" type="range" min="-30000" value="0" max="30000" step="100" title="correction" placeholder="correction">
                    <input id="correctionNumber" type="number" min="-30000" value="0" max="30000" step="10" title="correction" placeholder="correction">
                </div>
            </fieldset>
        </fieldset>

        <br/>
        <br/>

        <section class="outer">
        <fieldset class="outer">
        <legend>Debug</legend>

            
        <form id="form" style="display:inline-block">
            <input type="submit" style="display:none;">
            shell <input id="input" type="text" length="15" spellcheck="false">
        </form>
        <button id="ping">Ping</button>
        <button id="ping2">PingX</button>
        <button id="clear">clear</button>
        <br/>

        <textarea id="output" rows="20" cols="80" readonly></textarea>

        </fieldset>    
        </section>
            
    </body>
</html>